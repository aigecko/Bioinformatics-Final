<!DOCTYPE>
<html>
<head>
  <title>Bioinformatics</title>
</head>
<script>
  // get JSON data and update data block
  function show_query(data){
    // update data
    document.getElementById("output").innerHTML = "Term found."
    document.getElementById("term-id").innerHTML = data["accession"];
    document.getElementById("term-name").innerHTML = data["name"];
    document.getElementById("term-ns").innerHTML = data["namespace"];
    document.getElementById("term-def").innerHTML = data["definition"];
    document.getElementById("term-syn").innerHTML = data["synonyms"];
    // let output visible
    document.getElementById("term-output").style["display"] = "block";
  }
  // make a name query to database
  function query(){
    // waiting message
    document.getElementById("output").innerHTML = "Querying, please wait."
    document.getElementById("term-output").style["display"] = "none";
    document.getElementById("pmid-output").style["display"] = "none";
    // make request
    name=document.getElementById("Term").value;
    var xhttp = new XMLHttpRequest();
    var url = "https://grch37.rest.ensembl.org/ontology/name/"+name+"?";
    xhttp.open("GET", url , false);
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send();
    var response = JSON.parse(xhttp.responseText);
    // if request failed then error element will be a non-empty string
    if(response["error"]){
      document.getElementById("output").innerHTML = "Not a valid term."
    }
    else{
      show_query(response[0]);
    }
  }
  // make a PMID search
  function search(){
    document.getElementById("output").innerHTML = "PMID searching"
    document.getElementById("term-output").style["display"] = "none";
    document.getElementById("pmid-output").style["display"] = "none";
    // use CORS proxy to get cross-domain data from PubMed
    pmid=document.getElementById("PMID").value;
    var xhttp = new XMLHttpRequest();
    var url = "https://cors-anywhere.herokuapp.com/https://www.ncbi.nlm.nih.gov/pubmed/"+pmid;
    console.log(url)
    xhttp.open("GET", url , false);
    xhttp.setRequestHeader("Content-type", "text/plain");
    xhttp.send();
    var response = xhttp.responseText;
    parser = new DOMParser();
    // get the DOM of a whole page
    xml = parser.parseFromString(response,"text/xml").documentElement.innerHTML;
    // parse body part of DOM
    html = parser.parseFromString(xml,"text/html");
    // abstract part has an unique tag name
    var element = html.getElementsByTagName("abstracttext")[0];
    if(element){
      document.getElementById("output").innerHTML = "PMID found."
      var text = element.innerHTML;
      document.getElementById("pmid-output").innerHTML = text;
      document.getElementById("pmid-output").style["display"] = "block";
    }
    else{
      document.getElementById("output").innerHTML = "Not a valid PMID."
    }
  }
  (function load(){
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "/words_alpha.txt" , false);
    xhttp.setRequestHeader("Content-type", "text/plain");
    xhttp.send();
    var response = xhttp.responseText;
    words_list = response.split("\r\n");
  })();
</script>
<body >
  <button type="button" onclick="">Show all data</button><br>
  <input type="text" id="Term" name="Term" value="mitochondrion inheritance">
  <button type="button" onclick="query()">Query term</button><br>
  <input type="text" id="PMID" name="PMID" value="26318936">
  <button type="button" onclick="search()">Search PMID</button>
  <p id="output"></p>
  <p id="term-output" style="display: none">
    <span>id:&nbsp;</span><span id="term-id"></span><br/>
    <span>name:&nbsp;</span><span id="term-name"></span><br/>
    <span>namespace:&nbsp;</span><span id="term-ns"></span><br/>
    <span>def:&nbsp;</span><span id="term-def"></span><br/>
    <span>synonym:&nbsp;</span><span id="term-syn"></span><br/>
  </p>
  <p id="pmid-output"></p>
  <p id="ext-output" style="display: none">
    <span>term:&nbsp;</span><span id="ext-term"></span><br/>
    <span>namespace:&nbsp;</span><span id="ext-ns"></span><br/>
    <span>id:&nbsp;</span><span  id="ext-id"></span><br/>
    <span>synonym:&nbsp;</span><span id="ext-syn"></span><br/>
    <span>definition:&nbsp;</span><span id="ext-def"></span><br/>
  </p>
</body>
</html>